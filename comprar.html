<!DOCTYPE html>
<html lang="en">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Pizzeria Codo a Codo</title>
  
  <link rel="stylesheet" href="./css/estilos.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
  
  <header class="header">
    <img id="logoweb" src="./imagenes/el-rocoto-logo.png" alt="">
    <div id="tiempo"><!-- www.tutiempo.net - Ancho:116px - Alto:36px -->
      <div id="TT_yiewrhdhdnnaMeGKKAVjjjjDjWaKT4SlLY1d1sy5KEz">El tiempo - Tutiempo.net</div>
      <script type="text/javascript" src="https://www.tutiempo.net/s-widget/l_yiewrhdhdnnaMeGKKAVjjjjDjWaKT4SlLY1d1sy5KEz"></script></div>
      <a href="http://facebook.com"><img width="40" id="logofacebook" src="./imagenes/facebook.png" alt=""></a>
      <a href="http://instagram.com"><img width="40" id="logoinstagram" src="./imagenes/instagram.png" alt=""></a> 
  </div>
    <nav>
      <input type="checkbox" id="check">
      <label for="check" class="checkbtn">
          <img id="boton" src="./imagenes/boton.png" alt="10px">
      </label>
      <a href="#" class="enlace">
          <img src="./imagenes/" alt="" class="logo">
      </a>
      <ul>
        
          <li><a class="active" href="index.html">Inicio</a></li>
          <li><a href="#contenedor3">Donde Estamos</a></li>
          <li><a href="contacto.html">Contacto</a></li>
          <li><a href="comprar.html">Comprar</a></li>
          
      </ul>
  </nav>
  </header>

</head>

<body class="grid-container">

  

  <nav class="navbar">
    <img id="foto1" src="./imagenes/local-1.jpg" alt="">
    <h1 id="h1">BIENVENIDOS</h1>
    <h2 id="h2">Pizzeria Codo a Codo es una familia, que busca ser feliz brindando alimentos de calidad y al precio adecuado</h2>

    <img id="foto1" src="./imagenes/local-2.jpg" alt="">
     </nav>

        <article class="main">
          <!-- carrito -->
          <div id="mapa" class="col-12 p-0 mt-5 mb-5">
            <div class="card">
                <script>
                    document.addEventListener('DOMContentLoaded', () => {
                      // Variables
                      const baseDeDatos = [
                          {
                              id: 1,
                              nombre: 'Pizza Muzzarella',
                              precio: 800,
                              imagen: 'imagenes/Pizza-Muzzarella.jpg'
                          },
                          {
                              id: 2,
                              nombre: 'Pizza de palmitos',
                              precio: 900,
                              imagen: 'imagenes/Pizza-de-Palmitos-.jpg'
                          },
                          {
                              id: 3,
                              nombre: 'Pizza de Jamón y Morrón',
                              precio: 950,
                              imagen: 'imagenes/Pizza-de-Jamón-y-Morrón-.jpg'
                          },
                          {
                              id: 4,
                              nombre: 'Pizza Calabresa',
                              precio: 850,
                              imagen: 'imagenes/Pizza-Calabresa.jpg'
                          }
              
                      ];
              
                      let carrito = [];
                      const divisa = '$';
                      const DOMitems = document.querySelector('#items');
                      const DOMcarrito = document.querySelector('#carrito');
                      const DOMtotal = document.querySelector('#total');
                      const DOMbotonVaciar = document.querySelector('#boton-vaciar');
              
                      // Funciones
              
                      /**
                      * Dibuja todos los productos a partir de la base de datos. No confundir con el carrito
                      */
                      function renderizarProductos() {
                          baseDeDatos.forEach((info) => {
                              // Estructura
                              const miNodo = document.createElement('div');
                              miNodo.classList.add('card', 'col-sm-4');
                              // Body
                              const miNodoCardBody = document.createElement('div');
                              miNodoCardBody.classList.add('card-body');
                              // Titulo
                              const miNodoTitle = document.createElement('h5');
                              miNodoTitle.classList.add('card-title');
                              miNodoTitle.textContent = info.nombre;
                              // Imagen
                              const miNodoImagen = document.createElement('img');
                              miNodoImagen.classList.add('img-fluid');
                              miNodoImagen.setAttribute('src', info.imagen);
                              // Precio
                              const miNodoPrecio = document.createElement('p');
                              miNodoPrecio.classList.add('card-text');
                              miNodoPrecio.textContent = `${info.precio}${divisa}`;
                              // Boton 
                              const miNodoBoton = document.createElement('button');
                              miNodoBoton.classList.add('btn', 'btn-primary');
                              miNodoBoton.textContent = '+';
                              miNodoBoton.setAttribute('marcador', info.id);
                              miNodoBoton.addEventListener('click', anyadirProductoAlCarrito);
                              // Insertamos
                              miNodoCardBody.appendChild(miNodoImagen);
                              miNodoCardBody.appendChild(miNodoTitle);
                              miNodoCardBody.appendChild(miNodoPrecio);
                              miNodoCardBody.appendChild(miNodoBoton);
                              miNodo.appendChild(miNodoCardBody);
                              DOMitems.appendChild(miNodo);
                          });
                      }
              
                      /**
                      * Evento para añadir un producto al carrito de la compra
                      */
                      function anyadirProductoAlCarrito(evento) {
                          // Anyadimos el Nodo a nuestro carrito
                          carrito.push(evento.target.getAttribute('marcador'))
                          // Actualizamos el carrito 
                          renderizarCarrito();
              
                      }
              
                      /**
                      * Dibuja todos los productos guardados en el carrito
                      */
                      function renderizarCarrito() {
                          // Vaciamos todo el html
                          DOMcarrito.textContent = '';
                          // Quitamos los duplicados
                          const carritoSinDuplicados = [...new Set(carrito)];
                          // Generamos los Nodos a partir de carrito
                          carritoSinDuplicados.forEach((item) => {
                              // Obtenemos el item que necesitamos de la variable base de datos
                              const miItem = baseDeDatos.filter((itemBaseDatos) => {
                                  // ¿Coincide las id? Solo puede existir un caso
                                  return itemBaseDatos.id === parseInt(item);
                              });
                              // Cuenta el número de veces que se repite el producto
                              const numeroUnidadesItem = carrito.reduce((total, itemId) => {
                                  // ¿Coincide las id? Incremento el contador, en caso contrario no mantengo
                                  return itemId === item ? total += 1 : total;
                              }, 0);
                              // Creamos el nodo del item del carrito
                              const miNodo = document.createElement('li');
                              miNodo.classList.add('list-group-item', 'text-right', 'mx-2');
                              miNodo.textContent = `${numeroUnidadesItem} x ${miItem[0].nombre} - ${miItem[0].precio}${divisa}`;
                              // Boton de borrar
                              const miBoton = document.createElement('button');
                              miBoton.classList.add('btn', 'btn-danger', 'mx-5');
                              miBoton.textContent = 'X';
                              miBoton.style.marginLeft = '1rem';
                              miBoton.dataset.item = item;
                              miBoton.addEventListener('click', borrarItemCarrito);
                              // Mezclamos nodos
                              miNodo.appendChild(miBoton);
                              DOMcarrito.appendChild(miNodo);
                          });
                         // Renderizamos el precio total en el HTML
                         DOMtotal.textContent = calcularTotal();
                      }
              
                      /**
                      * Evento para borrar un elemento del carrito
                      */
                      function borrarItemCarrito(evento) {
                          // Obtenemos el producto ID que hay en el boton pulsado
                          const id = evento.target.dataset.item;
                          // Borramos todos los productos
                          carrito = carrito.filter((carritoId) => {
                              return carritoId !== id;
                          });
                          // volvemos a renderizar
                          renderizarCarrito();
                      }
              
                      /**
                       * Calcula el precio total teniendo en cuenta los productos repetidos
                       */
                      function calcularTotal() {
                          // Recorremos el array del carrito 
                          return carrito.reduce((total, item) => {
                              // De cada elemento obtenemos su precio
                              const miItem = baseDeDatos.filter((itemBaseDatos) => {
                                  return itemBaseDatos.id === parseInt(item);
                              });
                              // Los sumamos al total
                              return total + miItem[0].precio;
                          }, 0).toFixed(2);
                      }
              
                      /**
                      * Varia el carrito y vuelve a dibujarlo
                      */
                      function vaciarCarrito() {
                          // Limpiamos los productos guardados
                          carrito = [];
                          // Renderizamos los cambios
                          renderizarCarrito();
                      }
              
                      // Eventos
                      DOMbotonVaciar.addEventListener('click', vaciarCarrito);
              
                      // Inicio
                      renderizarProductos();
                      renderizarCarrito();
                    });
                </script>
              </head>
              <body>
                <div class="container">
                    <div class="row">
                        <!-- Elementos generados a partir del JSON -->
                        <main id="items" class="col-sm-8 row"></main>
                        <!-- Carrito -->
                        <aside class="col-sm-4">
                            <h2>Carrito</h2>
                            <!-- Elementos del carrito -->
                            <ul id="carrito" class="list-group"></ul>
                            <hr>
                            <!-- Precio total -->
                            <p class="text-right">Total: <span id="total"></span>$;</p>
                            <button id="boton-vaciar" class="btn btn-danger">Vaciar</button>
                        </aside>
                    </div>
                </div>
                
                  
        </article>
  
     

  
              <br>



   
   


             
              <footer class="footer">
                <img id="foto2" src="./imagenes/combo1.jpg" alt="">
                <img id="foto2" src="./imagenes/combo1.jpg" alt="">
                <img id="foto2" src="./imagenes/combo1.jpg" alt="">
                  <div id="contenedor3">
                      <h3> DONDE ESTAMOS
                        <br>
                        <a href="index.html">Volver</a>
                       </h3>
                       <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d2922.789815289753!2d-64.48542268516842!3d-31.093204987804366!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e1!3m2!1ses-419!2sar!4v1664851132982!5m2!1ses-419!2sar" width="100%" height="270" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                          
                       <br> <br> <p id="pie">© 2022. Codo a Codo Pizzas - Todos los derechos reservados.</p>
              </footer>
              </html>